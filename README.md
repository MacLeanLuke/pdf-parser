# Eligibility PDF Ingestor

Eligibility PDF Ingestor is a production-ready Next.js 14 application that helps housing and homeless-services teams turn program materials into structured eligibility data. Upload a PDF or point to a website, let the app extract text, validate it with OpenAI via the Vercel AI SDK, and store the structured result in PostgreSQL using Drizzle ORM.

## Features

- Upload a single PDF and trigger server-side parsing with `pdf-parse`.
- Analyze eligibility directly from public program web pages with the same schema.
- Extract eligibility rules using OpenAI (configurable model) and a strict Zod schema.
- Persist raw text, extracted eligibility text, and the full structured JSON in PostgreSQL.
- View results immediately including the eligibility excerpt, structured fields, and a debug JSON view.
- Browse and search past ingestions (PDF or web) from the unified history view.

## Getting Started

1. **Install dependencies**

   ```bash
   npm install
   ```

2. **Environment variables**

   Create a `.env.local` file with:

   ```bash
   OPENAI_API_KEY=your-openai-key
   DATABASE_URL=postgresql://user:password@host:5432/database
   OPENAI_MODEL=gpt-4.1 # optional, defaults to gpt-4.1
   ```

3. **Run migrations**

   ```bash
   npm run db:migrate
   ```

   The configuration lives in `drizzle.config.ts` and migrations are stored in the `drizzle/` directory.

4. **Start the dev server**

   ```bash
   npm run dev
   ```

   Open [http://localhost:3000](http://localhost:3000) to access the app.

## Project Structure

- `app/` – App Router pages and API routes (`/api/parse-eligibility`, `/api/parse-url`, `/api/eligibility-records`).
- `db/` – Drizzle schema and database client.
- `lib/` – PDF parsing helpers, eligibility schema, and AI integration.
- `drizzle/` – SQL migrations generated by Drizzle Kit.

## Deployment

Deploy like any other Next.js 14 application. Provide `OPENAI_API_KEY` and `DATABASE_URL` in the target environment. If deploying to platforms that require SSL for Postgres connections, set `sslmode` within the `DATABASE_URL` or adjust the pool configuration in `db/index.ts`.

## License

MIT © Luke Amy
